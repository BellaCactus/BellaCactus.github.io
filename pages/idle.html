<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>idle ‚Ä¢ bella cactus</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="icon" type="image/png" href="../media/favicon.png" />

  <style>
    :root{
      --bg:#070707;
      --bg2:#0b0b0b;
      --panel: rgba(255,255,255,0.055);
      --panel2: rgba(255,255,255,0.03);
      --border: rgba(255,255,255,0.10);
      --text:#f7f7f7;
      --muted:#b9b9c2;
      --pink:#ff78c8;
      --pink2:#ffb3e6;
      --shadow: 0 20px 70px rgba(0,0,0,0.55);
      --radius:16px;
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      --sans: ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, Arial, sans-serif;
    }

    *{box-sizing:border-box;}
    html,body{height:100%;}
    body{
      margin:0;
      background:
        radial-gradient(900px 600px at 15% 12%, rgba(255,120,200,0.14), transparent 55%),
        radial-gradient(900px 600px at 90% 30%, rgba(255,179,230,0.10), transparent 55%),
        radial-gradient(1200px 700px at 40% 95%, rgba(255,77,184,0.08), transparent 55%),
        linear-gradient(180deg, var(--bg), var(--bg2));
      color:var(--text);
      font-family: var(--sans);
      overflow:hidden;
    }

    a{color:var(--pink); text-decoration:none;}
    a:hover{text-decoration:underline;}

    .pulseText{
      background: linear-gradient(90deg, #ffffff, var(--pink), #ffffff, var(--pink2), #ffffff);
      background-size: 260% 100%;
      -webkit-background-clip:text;
      background-clip:text;
      color:transparent;
      animation: shimmer 4.8s ease-in-out infinite;
    }
    @keyframes shimmer{
      0%{background-position:0% 50%;}
      50%{background-position:100% 50%;}
      100%{background-position:0% 50%;}
    }

    /* background layer */
    #bg{
      position:fixed;
      inset:0;
      z-index:0;
    }

    /* ui */
    .wrap{
      position:relative;
      z-index:2;
      max-width:980px;
      margin:0 auto;
      padding:22px 16px;
      pointer-events:none; /* let screensaver be click-through */
    }

    .panel{
      pointer-events:auto;
      background: linear-gradient(180deg, var(--panel), var(--panel2));
      border:1px solid var(--border);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow:hidden;
      backdrop-filter: blur(6px);
    }

    .panelTitle{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      padding:12px 14px;
      border-bottom:1px solid rgba(255,255,255,0.06);
      background: rgba(0,0,0,0.18);
    }
    .panelTitle h1{
      margin:0;
      font-size:1.05rem;
      color:var(--pink2);
      letter-spacing:0.3px;
      font-weight:700;
    }
    .small{
      font-size:0.86rem;
      color:var(--muted);
      font-family: var(--mono);
      opacity:0.95;
    }

    .panelInner{
      padding:12px 14px;
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
      justify-content:space-between;
    }

    .btnRow{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
    }

    .btn{
      cursor:pointer;
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding:10px 12px;
      border-radius:12px;
      border:1px solid rgba(255,255,255,0.10);
      background: rgba(255,255,255,0.05);
      color:var(--text);
      transition: transform 0.08s ease, background 0.2s ease, border 0.2s ease, opacity 0.2s ease;
      text-decoration:none;
      user-select:none;
      font-family: var(--sans);
      font-size:0.95rem;
      pointer-events:auto;
    }
    .btn:hover{
      text-decoration:none;
      transform: translateY(-1px);
      border-color: rgba(255,120,200,0.35);
      background: rgba(255,120,200,0.10);
    }
    .btn:active{ transform: translateY(0); opacity:0.95; }
    .btn .k{ font-family: var(--mono); font-size:0.8rem; color:var(--pink2); }

    .tog{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding:8px 10px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,0.10);
      background: rgba(0,0,0,0.22);
      color:var(--muted);
      font-family: var(--mono);
      font-size:0.82rem;
      user-select:none;
      pointer-events:auto;
    }
    .tog input{ accent-color: var(--pink); }

    /* corner hint */
    .hint{
      position:fixed;
      left:12px;
      bottom:12px;
      z-index:3;
      color:rgba(255,255,255,0.72);
      font-family: var(--mono);
      font-size:0.82rem;
      background: rgba(0,0,0,0.25);
      border:1px solid rgba(255,255,255,0.10);
      padding:8px 10px;
      border-radius:12px;
      backdrop-filter: blur(6px);
      pointer-events:none;
    }

    /* oneko */
    .oneko{
      position:fixed;
      bottom:12px;
      right:12px;
      z-index:4;
      opacity:0.95;
      filter: drop-shadow(0 14px 28px rgba(0,0,0,0.6));
      transform: translateZ(0);
      animation: floaty 3.6s ease-in-out infinite;
      cursor:pointer;
      user-select:none;
      pointer-events:auto;
    }
    @keyframes floaty{
      0%{transform: translateY(0);}
      50%{transform: translateY(-6px);}
      100%{transform: translateY(0);}
    }
    .oneko img{ width:52px; image-rendering:pixelated; display:block; }

    /* reduced motion */
    @media (prefers-reduced-motion: reduce){
      .pulseText{ animation:none; }
      .oneko{ animation:none; }
    }


/* auto-hide ui when you stop moving */
body.uiHidden .wrap{ opacity:0; transform: translateY(-8px); pointer-events:none; }
body.uiHidden .hint{ opacity:0; }
.wrap{ transition: opacity .35s ease, transform .35s ease; }
.hint{ transition: opacity .35s ease; }

/* evil sync (if index is set to red theme) */
body.evil{ filter: contrast(1.12) saturate(1.22) hue-rotate(-6deg); }
body.evil::after{
  content:"";
  position:fixed;
  inset:0;
  pointer-events:none;
  z-index:5;
  background:repeating-linear-gradient(to bottom, rgba(255,0,0,0.08) 0px, rgba(255,0,0,0.08) 1px, transparent 3px, transparent 6px);
  opacity:0.35;
  mix-blend-mode: screen;
  animation: scan 6.2s linear infinite;
}
@keyframes scan{ from{background-position-y:0} to{background-position-y:28px} }

/* volume slider */
.volWrap{
  pointer-events:auto;
  display:flex;
  align-items:center;
  gap:10px;
  padding:8px 10px;
  border-radius:999px;
  border:1px solid rgba(255,255,255,0.10);
  background: rgba(0,0,0,0.22);
  color:var(--muted);
  font-family: var(--mono);
  font-size:0.82rem;
  user-select:none;
}
.volWrap .k{ color:var(--pink2); }
input.vol{
  width:170px;
  accent-color: var(--pink);
  cursor:pointer;
}
.volNum{ min-width:48px; text-align:right; }
@media (max-width: 520px){
  input.vol{ width:120px; }
  .panelInner{ gap:8px; }
  .volWrap{ width:100%; justify-content:space-between; }
}
  </style>
</head>

<body>
  <canvas id="bg" aria-hidden="true"></canvas>

  <div class="wrap">
    <div class="panel">
      <div class="panelTitle">
        <h1>idle screensaver</h1>
        <div class="small">leave me open ‚Ä¢ press <span class="pulseText">space</span> to pause ‚Ä¢ <span class="pulseText">r</span> to reroll</div>
      </div>
      <div class="panelInner">
        <div class="btnRow">
          <a class="btn" href="../index.html"><span class="k">cd</span> home</a>
          <button class="btn" id="btnPause" type="button"><span class="k">‚è∏</span> pause</button>
          <button class="btn" id="btnReroll" type="button"><span class="k">rng</span> reroll</button>
          <button class="btn" id="btnTheme" type="button"><span class="k">fx</span> pink/white</button>
        </div>

        <label class="tog" title="less chaos, more calm">
          <input id="chkSoft" type="checkbox" />
          soft mode
        </label>

        <label class="tog" title="fake audio viz if you don't want real audio">
          <input id="chkFakeViz" type="checkbox" checked />
          fake viz
        </label>

        <label class="tog" title="autoplay attempt: Mobile Suit Woe (click once if browser blocks)">
          <input id="chkAudio" type="checkbox" checked />
          audio
        </label>

<div class="volWrap" title="volume (saved)">
  <span class="k">vol</span>
  <input id="vol" class="vol" type="range" min="0" max="100" value="70" />
  <span class="volNum" id="volNum">70%</span>
</div>
      </div>
    </div>
  </div>

  <div class="hint">tip: click anywhere once if audio is blocked (browser rules) (:3)</div>

  <div class="oneko" id="oneko" title="click me" aria-hidden="false">
    <img id="onekoImg" src="../media/oneko.gif" alt="oneko" />
  </div>

  <audio id="bgm" preload="auto" loop>
    <source src="../assests/Mobile Suit Woe 0.mp3" type="audio/mpeg" />
  </audio>

  <audio id="yeah" preload="auto">
    <source src="../assests/lil-jon-yeah.mp3" type="audio/mpeg" />
  </audio>

  <script>
    const $ = (id) => document.getElementById(id);
    const clamp = (n,a,b) => Math.max(a, Math.min(b,n));
    const rand = (a,b) => a + Math.random() * (b - a);
    const pick = (arr) => arr[Math.floor(Math.random() * arr.length)];

    // oneko fallback
    const onekoImg = $("onekoImg");
    onekoImg.addEventListener("error", () => {
      if (!onekoImg.dataset.tried) {
        onekoImg.dataset.tried = "1";
        onekoImg.src = "../media/oneko.gif";
      }
    });

    // oneko click: lil jon yeah if present
    $("oneko").addEventListener("click", async () => {
      try { await resumeAudio(); } catch(e){}
      const y = $("yeah");
      y.currentTime = 0;
      y.play().catch(()=>{});
    });

// theme sync with index (pink / white / red)
const THEME_KEY = "bella_theme";
const THEMES = ["pink","white","violet","cyan","lime","red"]; // red = evil
let theme = localStorage.getItem(THEME_KEY) || "pink";

// keep the existing render logic happy
let pinkMode = theme !== "white";


function setCssThemeVars(mode){
  if (mode === "white"){
    document.documentElement.style.setProperty("--pink", "#ffffff");
    document.documentElement.style.setProperty("--pink2", "#d6d6dc");
  } else if (mode === "violet"){
    document.documentElement.style.setProperty("--pink", "#b66cff");
    document.documentElement.style.setProperty("--pink2", "#e0c2ff");
  } else if (mode === "cyan"){
    document.documentElement.style.setProperty("--pink", "#40fff0");
    document.documentElement.style.setProperty("--pink2", "#b8fffb");
  } else if (mode === "lime"){
    document.documentElement.style.setProperty("--pink", "#a6ff4d");
    document.documentElement.style.setProperty("--pink2", "#d7ffad");
  } else if (mode === "red"){
    document.documentElement.style.setProperty("--pink", "#ff2a2a");
    document.documentElement.style.setProperty("--pink2", "#ff7a7a");
  } else {
    document.documentElement.style.setProperty("--pink", "#ff78c8");
    document.documentElement.style.setProperty("--pink2", "#ffb3e6");
  }
}

function applyTheme(){
  pinkMode = theme !== "white";
  setCssThemeVars(theme);
  document.body.classList.toggle("evil", theme === "red");
  const btn = $("btnTheme");
  if (btn){
    const label = (theme === 'red') ? 'evil' : theme;
    btn.innerHTML = `<span class="k">fx</span> theme: ${label}`;
  }
}

function cycleTheme(){
  const i = THEMES.indexOf(theme);
  theme = THEMES[(i + 1) % THEMES.length];
  localStorage.setItem(THEME_KEY, theme);
  applyTheme();
}

applyTheme();

    // canvas
    const c = $("bg");
    const ctx = c.getContext("2d");

    function fit(){
      const dpr = devicePixelRatio || 1;
      c.width = Math.floor(innerWidth * dpr);
      c.height = Math.floor(innerHeight * dpr);
      c.style.width = innerWidth + "px";
      c.style.height = innerHeight + "px";
      ctx.setTransform(dpr,0,0,dpr,0,0);
    }
    addEventListener("resize", () => { fit(); reroll(); });
    fit();

    // ascii sprites
    const critters = [
` /\\_/\\
( o.o )
 > ^ <`,
` (\\_/)
 ( ‚Ä¢_‚Ä¢)
 / >üç™`,
`  /\\_/\\
 (=^.^=)
 (")(")`,
`  /\\_/\\
 ( >.< )
  >üçì<`,
`   /\\_/\\
  ( ‚Ä¢œâ‚Ä¢ )
  /    \\`,
`  /^-----^\\
 V  o o  V
  |  Y  |
   \\ Q /`
    ];

    const whispers = [
      "buffering dreams‚Ä¶",
      "rendering midnight UI‚Ä¶",
      "your tabs are alive",
      "soft reboot of the soul",
      "do not disturb: building",
      "pink glow, low hp",
      "this is fine. (it isn't.)",
      "sleep mode: feral",
      "signal found in the static",
      "press r to reroll reality"
    ];

    const stars = [];
    const texts = [];
    const sprites = [];

    let softMode = false;

    function makeStars(){
      stars.length = 0;
      const n = clamp(Math.floor((innerWidth * innerHeight) / 14000), 40, 140);
      for (let i=0;i<n;i++){
        stars.push({
          x: Math.random() * innerWidth,
          y: Math.random() * innerHeight,
          r: rand(0.6, 2.2),
          v: rand(0.08, 0.35),
          p: Math.random() * Math.PI * 2
        });
      }
    }

    function makeTexts(){
      texts.length = 0;
      const n = clamp(Math.floor(innerWidth / 260), 3, 7);
      for (let i=0;i<n;i++){
        texts.push({
          t: pick(whispers),
          x: rand(-200, innerWidth + 200),
          y: rand(80, innerHeight - 80),
          vx: rand(-0.18, -0.05),
          a: rand(0.22, 0.55),
          s: rand(12, 15),
          wob: rand(0.6, 1.6),
          phase: Math.random() * Math.PI * 2
        });
      }
    }

    function makeSprites(){
      sprites.length = 0;
      const n = clamp(Math.floor(innerWidth / 260), 3, 8);
      for (let i=0;i<n;i++){
        const art = pick(critters);
        const lines = art.split("\n");
        const w = Math.max(...lines.map(l => l.length));
        sprites.push({
          art,
          lines,
          wChars: w,
          x: rand(40, innerWidth - 200),
          y: rand(120, innerHeight - 120),
          vx: rand(-0.12, 0.12),
          vy: rand(-0.09, 0.09),
          rot: rand(-0.18, 0.18),
          rvel: rand(-0.0015, 0.0015),
          a: rand(0.35, 0.80),
          s: rand(12, 15),
          hue: rand(0, 1)
        });
      }
    }

    // subtle viz (fake or audio)
    const bgm = $("bgm");

// volume (saved)
const VOL_KEY = "bella_volume";
const volEl = $("vol");
const volNum = $("volNum");
const savedVol = Number(localStorage.getItem(VOL_KEY));
const initialVol = Number.isFinite(savedVol) ? savedVol : 0.70;

function setVolume(v){
  const vv = Math.max(0, Math.min(1, v));
  bgm.volume = vv;
  if (volEl) volEl.value = String(Math.round(vv * 100));
  if (volNum) volNum.textContent = `${Math.round(vv * 100)}%`;
  localStorage.setItem(VOL_KEY, String(vv));
}

setVolume(initialVol);

if (volEl){
  volEl.addEventListener("input", (e) => {
    const v = Number(e.target.value) / 100;
    setVolume(v);
  });
}
    let audioCtx = null, analyser = null, data = null, srcNode = null;

    async function resumeAudio(){
      if (!audioCtx) return;
      if (audioCtx.state === "suspended") await audioCtx.resume();
    }

    function setupAudio(){
      if (audioCtx) return;
      audioCtx = new (window.AudioContext || window.webkitAudioContext)();
      try{
        srcNode = audioCtx.createMediaElementSource(bgm);
        analyser = audioCtx.createAnalyser();
        analyser.fftSize = 512;
        data = new Uint8Array(analyser.frequencyBinCount);
        srcNode.connect(analyser);
        analyser.connect(audioCtx.destination);
      }catch(e){
        // some browsers can be weird; fallback to fake viz
        analyser = null;
      }
    }

    function readViz(){
      const fake = $("chkFakeViz").checked || !analyser || bgm.paused;
      const arrLen = 128;
      const arr = new Float32Array(arrLen);

      if (fake){
        const t = performance.now() * 0.001;
        for (let i=0;i<arrLen;i++){
          const k = i / (arrLen - 1);
          const wave = Math.sin(t * 2.2 + k * 10.0) * 0.35
                     + Math.sin(t * 1.1 + k * 21.0) * 0.18
                     + Math.sin(t * 0.7 + k * 5.0) * 0.12;
          const drift = (Math.sin(t * 0.35) * 0.12);
          arr[i] = (wave + drift);
        }
        return arr;
      }

      analyser.getByteTimeDomainData(data);
      for (let i=0;i<arrLen;i++){
        const idx = Math.floor(i / (arrLen - 1) * (data.length - 1));
        arr[i] = (data[idx] / 255) * 2 - 1; // -1..1
      }
      return arr;
    }

    function drawViz(){
      const v = readViz();
      const yMid = innerHeight * (softMode ? 0.72 : 0.68);
      const amp = softMode ? 18 : 30;

      ctx.save();
      ctx.globalAlpha = softMode ? 0.32 : 0.50;
      ctx.lineWidth = 2;
      ctx.strokeStyle = getComputedStyle(document.documentElement).getPropertyValue("--pink").trim() || "#ff78c8";
      ctx.shadowColor = ctx.strokeStyle;
      ctx.shadowBlur = softMode ? 8 : 14;

      ctx.beginPath();
      for (let i=0;i<v.length;i++){
        const x = (i / (v.length - 1)) * innerWidth;
        const y = yMid + v[i] * amp;
        if (i === 0) ctx.moveTo(x,y);
        else ctx.lineTo(x,y);
      }
      ctx.stroke();

      // faint center line
      ctx.shadowBlur = 0;
      ctx.globalAlpha = 0.16;
      ctx.beginPath();
      ctx.moveTo(0, yMid);
      ctx.lineTo(innerWidth, yMid);
      ctx.strokeStyle = "#ffffff";
      ctx.stroke();

      ctx.restore();
    }

    function reroll(){
      makeStars();
      makeTexts();
      makeSprites();
    }
    reroll();

    // animation loop
    let paused = false;
    function draw(){
      requestAnimationFrame(draw);
      if (paused) return;

      // clear
      ctx.clearRect(0,0,innerWidth, innerHeight);

      // stars
      ctx.save();
      for (const s of stars){
        s.p += s.v * 0.02;
        s.y += s.v;
        s.x += Math.sin(s.p) * 0.08;

        if (s.y > innerHeight + 10){
          s.y = -10;
          s.x = Math.random() * innerWidth;
        }

        ctx.globalAlpha = 0.18 + Math.sin(s.p) * 0.08;
        ctx.beginPath();
        ctx.arc(s.x, s.y, s.r, 0, Math.PI*2);
        ctx.fillStyle = "#ffffff";
        ctx.fill();
      }
      ctx.restore();

      // drifting whisper text
      ctx.save();
      for (const t of texts){
        t.phase += 0.01 * t.wob;
        t.x += t.vx * (softMode ? 0.55 : 1);
        const yy = t.y + Math.sin(t.phase) * (softMode ? 8 : 14);

        if (t.x < -520){
          t.x = innerWidth + rand(120, 520);
          t.y = rand(80, innerHeight - 80);
          t.t = pick(whispers);
          t.a = rand(0.22, softMode ? 0.40 : 0.55);
        }

        ctx.globalAlpha = t.a;
        ctx.font = `${t.s}px ${getComputedStyle(document.body).getPropertyValue("--mono") || "ui-monospace, monospace"}`;
        ctx.fillStyle = pinkMode ? "rgba(255,179,230,0.95)" : "rgba(230,230,236,0.92)";
        ctx.shadowColor = pinkMode ? "rgba(255,120,200,0.35)" : "rgba(255,255,255,0.25)";
        ctx.shadowBlur = softMode ? 8 : 14;
        ctx.fillText(t.t, t.x, yy);
      }
      ctx.restore();

      // ascii sprites
      ctx.save();
      for (const s of sprites){
        s.x += s.vx * (softMode ? 0.55 : 1);
        s.y += s.vy * (softMode ? 0.55 : 1);
        s.rot += s.rvel * (softMode ? 0.65 : 1);

        // soft bounce boundaries
        const pad = 40;
        if (s.x < pad || s.x > innerWidth - pad) s.vx *= -1;
        if (s.y < pad || s.y > innerHeight - pad) s.vy *= -1;

        ctx.translate(s.x, s.y);
        ctx.rotate(s.rot);

        ctx.globalAlpha = s.a * (softMode ? 0.75 : 1);
        ctx.font = `${s.s}px ${getComputedStyle(document.body).getPropertyValue("--mono") || "ui-monospace, monospace"}`;
        ctx.textBaseline = "top";

        // draw multi-line ascii with glow
        ctx.shadowBlur = softMode ? 10 : 16;
        ctx.shadowColor = pinkMode ? "rgba(255,120,200,0.35)" : "rgba(255,255,255,0.18)";
        ctx.fillStyle = pinkMode ? "rgba(255,255,255,0.90)" : "rgba(245,245,250,0.85)";

        const lines = s.lines;
        for (let i=0;i<lines.length;i++){
          ctx.fillText(lines[i], 0, i * (s.s + 1));
        }

        ctx.setTransform(devicePixelRatio || 1,0,0,devicePixelRatio || 1,0,0);
        ctx.setTransform(1,0,0,1,0,0);
      }
      ctx.restore();

      // subtle viz line
      drawViz();
    }

    // controls
    function setPaused(v){
      paused = v;
      $("btnPause").innerHTML = paused ? `<span class="k">‚ñ∂</span> resume` : `<span class="k">‚è∏</span> pause`;
    }

    $("btnPause").addEventListener("click", () => setPaused(!paused));
    $("btnReroll").addEventListener("click", () => reroll());
    $("btnTheme").addEventListener("click", () => { cycleTheme(); });
    $("chkSoft").addEventListener("change", (e) => { softMode = !!e.target.checked; });

    // optional audio
    $("chkAudio").addEventListener("change", async (e) => {
      const on = !!e.target.checked;
      if (on){
        setupAudio();
        await resumeAudio().catch(()=>{});
        bgm.play().catch(()=>{});
      } else {
        try{ bgm.pause(); }catch(e2){}
      }
    });


// --- ui auto-hide (no mouse movement) ---
const UI_HIDE_MS = 2600;
let uiTimer = null;

function showUI(){
  document.body.classList.remove("uiHidden");
  clearTimeout(uiTimer);
  uiTimer = setTimeout(() => document.body.classList.add("uiHidden"), UI_HIDE_MS);
}

["mousemove","mousedown","touchstart","keydown","pointermove"].forEach(ev => {
  addEventListener(ev, showUI, { passive:true });
});

showUI();

// --- autoplay attempt (browser may require one interaction) ---
async function tryStartAudio(){
  try{ setupAudio(); }catch(e){}
  try{ await resumeAudio(); }catch(e){}
  try{ await bgm.play(); }catch(e){}
}

// if checkbox is on by default, try right away + on first interaction
if ($("chkAudio").checked){
  tryStartAudio();
  const unlock = async () => {
    await tryStartAudio();
    removeEventListener("pointerdown", unlock, true);
    removeEventListener("keydown", unlock, true);
  };
  addEventListener("pointerdown", unlock, true);
  addEventListener("keydown", unlock, true);
}

    // keyboard
    addEventListener("keydown", (e) => {
      const k = (e.key || "").toLowerCase();
      if (k === " "){ e.preventDefault(); setPaused(!paused); }
      if (k === "r"){ reroll(); }
      if (k === "t"){ cycleTheme(); }
      if (k === "escape"){ location.href = "../index.html"; }
    });

    // start
    draw();
  </script>
</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>ascii zoo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="icon" type="image/png" href="twi looking.png" />

  <style>
    :root{
      --bg:#070707;
      --bg2:#0b0b0b;
      --panel: rgba(255,255,255,0.055);
      --panel2: rgba(255,255,255,0.03);
      --border: rgba(255,255,255,0.10);

      --text:#f7f7f7;
      --muted:#b9b9c2;

      --pink:#ff78c8;
      --pink2:#ffb3e6;

      --shadow: 0 20px 70px rgba(0,0,0,0.55);
      --radius:16px;

      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      --sans: ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, Arial, sans-serif;
    }

    *{box-sizing:border-box;}
    html,body{height:100%;}
    body{
      margin:0;
      background:
        radial-gradient(800px 500px at 15% 10%, rgba(255,120,200,0.14), transparent 55%),
        radial-gradient(900px 600px at 90% 30%, rgba(255,179,230,0.10), transparent 55%),
        radial-gradient(1000px 700px at 40% 95%, rgba(255,77,184,0.08), transparent 55%),
        linear-gradient(180deg, var(--bg), var(--bg2));
      color:var(--text);
      font-family: var(--sans);
      line-height:1.55;
      overflow-x:hidden;
    }

    a{color:var(--pink); text-decoration:none;}
    a:hover{text-decoration:underline;}

    .pulseText{
      background: linear-gradient(90deg, #ffffff, var(--pink), #ffffff, var(--pink2), #ffffff);
      background-size: 260% 100%;
      -webkit-background-clip:text;
      background-clip:text;
      color:transparent;
      animation: shimmer 4.8s ease-in-out infinite;
    }
    @keyframes shimmer{
      0%{background-position:0% 50%;}
      50%{background-position:100% 50%;}
      100%{background-position:0% 50%;}
    }

    .wrap{
      max-width:980px;
      margin:0 auto;
      padding:44px 16px 110px;
      position:relative;
      z-index:2;
    }

    .top{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:14px;
      margin-bottom:18px;
    }
    .brand{
      display:flex;
      align-items:center;
      gap:14px;
      min-width:0;
    }
    .badge{
      width:56px;
      height:56px;
      border-radius:14px;
      background: linear-gradient(180deg, rgba(255,120,200,0.22), rgba(255,120,200,0.06));
      border:1px solid rgba(255,120,200,0.25);
      display:grid;
      place-items:center;
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    .badge img{
      width:100%;
      height:100%;
      object-fit:cover;
      filter: saturate(1.05) contrast(1.05);
    }
    h1{
      margin:0;
      font-size:2rem;
      letter-spacing:0.5px;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }
    .sub{
      margin:4px 0 0;
      color:var(--muted);
      font-size:0.98rem;
      max-width:560px;
    }

    .chips{
      display:flex;
      gap:8px;
      flex-wrap:wrap;
      justify-content:flex-end;
    }
    .chip{
      font-size:0.82rem;
      padding:6px 10px;
      border-radius:999px;
      border:1px solid var(--border);
      background: rgba(255,255,255,0.04);
      color:var(--muted);
      backdrop-filter: blur(6px);
    }
    .chip strong{color:var(--text); font-weight:600;}
    .chip .dot{
      display:inline-block;
      width:6px;height:6px;
      border-radius:999px;
      margin-right:6px;
      background:var(--pink);
      box-shadow:0 0 12px rgba(255,120,200,0.6);
    }

    .grid{
      display:grid;
      grid-template-columns: 1.15fr 0.85fr;
      gap:14px;
      margin-top:14px;
    }
    @media (max-width: 860px){
      .grid{grid-template-columns:1fr;}
      .chips{justify-content:flex-start;}
      .sub{max-width:100%;}
    }

    .panel{
      background: linear-gradient(180deg, var(--panel), var(--panel2));
      border:1px solid var(--border);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow:hidden;
      position:relative;
    }
    .panelInner{ padding:16px 16px; }
    .panelTitle{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      padding:14px 16px;
      border-bottom:1px solid rgba(255,255,255,0.06);
      background: rgba(0,0,0,0.18);
    }
    .panelTitle h2{
      margin:0;
      font-size:1.05rem;
      color:var(--pink2);
      letter-spacing:0.3px;
    }
    .small{
      font-size:0.86rem;
      color:var(--muted);
    }

    .btnRow{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      margin-top:10px;
    }
    .btn{
      cursor:pointer;
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding:10px 12px;
      border-radius:12px;
      border:1px solid rgba(255,255,255,0.10);
      background: rgba(255,255,255,0.05);
      color:var(--text);
      transition: transform 0.08s ease, background 0.2s ease, border 0.2s ease, opacity 0.2s ease;
      text-decoration:none;
      user-select:none;
    }
    .btn:hover{
      text-decoration:none;
      transform: translateY(-1px);
      border-color: rgba(255,120,200,0.35);
      background: rgba(255,120,200,0.10);
    }
    .btn:active{ transform: translateY(0); opacity:0.95; }
    .btn .k{
      font-family: var(--mono);
      font-size:0.8rem;
      color:var(--pink2);
    }

    .terminal{
      background: radial-gradient(900px 300px at 20% 0%, rgba(255,120,200,0.14), transparent 55%),
                  rgba(0,0,0,0.35);
      border-top:1px solid rgba(255,255,255,0.05);
      font-family: var(--mono);
      padding:14px 16px;
      min-height:220px;
    }
    .asciiBox{
      border:1px solid rgba(255,255,255,0.08);
      background: rgba(0,0,0,0.35);
      border-radius:14px;
      padding:12px 12px;
      margin-top:12px;
    }
    .ascii{
      white-space:pre;
      font-size:13px;
      line-height:1.15;
      margin:0;
      font-family: var(--mono);
      color: rgba(255,255,255,0.92);
    }
    .mono{
      font-family: var(--mono);
    }

    /* toggle: pink vs white */
    body.whiteMode{
      --pink:#ffffff;
      --pink2:#ffffff;
    }
    body.whiteMode .pulseText{
      background: linear-gradient(90deg, #ffffff, #ffffff, #ffffff);
      background-size: 100% 100%;
      animation: none;
      color: transparent;
      -webkit-background-clip:text;
      background-clip:text;
    }

    /* stash cards */
    .stashGrid{
      display:grid;
      grid-template-columns: 1fr;
      gap:10px;
      margin-top:10px;
    }
    .stashItem{
      border:1px solid rgba(255,255,255,0.10);
      background: rgba(0,0,0,0.25);
      border-radius:14px;
      padding:10px;
      display:flex;
      gap:10px;
      align-items:flex-start;
      overflow:hidden;
    }
    .thumb{
      width:84px;
      height:84px;
      border-radius:12px;
      border:1px solid rgba(255,255,255,0.10);
      background: rgba(255,255,255,0.03);
      overflow:hidden;
      flex: 0 0 auto;
      display:grid;
      place-items:center;
      font-family: var(--mono);
      font-size: 12px;
      color: var(--muted);
    }
    .thumb img{
      width:100%;
      height:100%;
      object-fit:cover;
      display:block;
    }
    .meta{
      min-width:0;
      flex: 1;
    }
    .meta .name{
      font-family: var(--mono);
      font-size: 0.9rem;
      color: rgba(255,255,255,0.92);
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }
    .meta .info{
      margin-top:4px;
      font-size: 0.82rem;
      color: var(--muted);
    }
    .stashActions{
      display:flex;
      gap:8px;
      flex-wrap:wrap;
      margin-top:8px;
    }

    audio{ width:100%; margin-top:10px; }

    /* background stickers */
    #wall{
      position:fixed;
      inset:0;
      z-index:1;
      pointer-events:none;
      overflow:hidden;
    }
    .sticker{
      position:absolute;
      pointer-events:auto;
      transition: opacity 0.18s ease, filter 0.18s ease, transform 0.18s ease;
      opacity:0.42;
      filter: drop-shadow(0 16px 32px rgba(0,0,0,0.45));
      user-select:none;
    }
    .sticker:hover{ opacity:0.06; filter:none; }
    .sticker img{
      display:block;
      width:100%;
      height:100%;
      object-fit:contain;
      border-radius:10px;
    }
  </style>
</head>

<body>
  <div id="wall" aria-hidden="true"></div>

  <div class="wrap">
    <div class="top">
      <div class="brand">
        <div class="badge" aria-hidden="true">
          <img src="twi looking.png" alt="badge" />
        </div>
        <div class="titlebox">
          <h1 class="pulseText">ascii zoo</h1>
          <div class="sub">terminal pets. rerollable. mildly unhinged. (:3)</div>
        </div>
      </div>

      <div class="chips">
        <div class="chip"><span class="dot"></span><strong class="pulseText">pink mode</strong></div>
        <div class="chip">stash: <strong id="stashCount">0</strong></div>
        <div class="chip">local save: <strong>indexeddb</strong></div>
      </div>
    </div>

    <div class="grid">
      <section class="panel">
        <div class="panelTitle">
          <h2>zoo</h2>
          <div class="small">cycles, rerolls, doesn‚Äôt spam lines</div>
        </div>
        <div class="panelInner">
          <div class="btnRow">
            <a class="btn" href="index.html"><span class="k">cd</span> home</a>
            <a class="btn" href="os.html"><span class="k">open</span> os</a>
            <button class="btn" id="reroll"><span class="k">rng</span> reroll creature</button>
            <button class="btn" id="toggleColor"><span class="k">pal</span> pink/white</button>
          </div>

          <div class="terminal">
            <div class="asciiBox">
              <pre class="ascii" id="creature"></pre>
            </div>
            <div class="small mono" style="margin-top:10px;">
              tip: click reroll, or just watch it swap every few seconds.
            </div>
          </div>
        </div>
      </section>

      <aside class="panel">
        <div class="panelTitle">
          <h2>upload stash (local)</h2>
          <div class="small">saved on *this* browser</div>
        </div>
        <div class="panelInner">
          <div class="small">
            this can store images + audio locally (IndexedDB). it won‚Äôt sync to other devices unless you use a real backend.
          </div>

          <div class="btnRow">
            <label class="btn" style="pointer-events:auto;">
              <span class="k">+</span> add file
              <input id="fileInput" type="file" accept="image/*,audio/*" style="display:none;" />
            </label>
            <button class="btn" id="clearStash"><span class="k">rm</span> clear stash</button>
          </div>

          <div id="stash" class="stashGrid"></div>

          <audio id="player" controls style="display:none;"></audio>
        </div>
      </aside>
    </div>

    <div class="panel" style="margin-top:14px;">
      <div class="panelTitle">
        <h2>notes</h2>
        <div class="small">how ‚Äúpermanent‚Äù works here</div>
      </div>
      <div class="panelInner small">
        <ul style="margin:0; padding-left:18px; color:var(--muted);">
          <li><span class="pulseText">local permanent</span>: saved in your browser storage. survives refresh. survives reboot.</li>
          <li><span class="pulseText">not global</span>: other people won‚Äôt see your uploads. other devices won‚Äôt either.</li>
          <li><span class="pulseText">global permanent</span> needs a backend (firebase/supabase/cloudinary) or you commit files to the repo.</li>
        </ul>
      </div>
    </div>

    <div class="small" style="margin-top:16px; text-align:center; color:var(--muted);">
      ¬© <span class="pulseText">bella cactus</span> ‚Ä¢ ascii zoo
    </div>
  </div>

  <script>
    // ---------- helpers
    const $ = (id) => document.getElementById(id);
    const rand = (a,b)=> a + Math.random()*(b-a);

    // ---------- stickers (simple grid placement so they don't overlap much)
    const wall = $("wall");
    const stickerFiles = ["twi looking.png","twi and trixy.jpg","ponies in bed.jpg","yuri meme.png"];

    function clearWall(){ wall.innerHTML = ""; }

    function spawnStickers(){
      clearWall();
      const w = window.innerWidth;
      const h = window.innerHeight;
      const cols = w < 800 ? 3 : 4;
      const rows = h < 700 ? 3 : 4;

      const cells = [];
      for(let r=0;r<rows;r++){
        for(let c=0;c<cols;c++){
          cells.push({r,c});
        }
      }
      // shuffle
      for (let i=cells.length-1;i>0;i--){
        const j = Math.floor(Math.random()*(i+1));
        [cells[i],cells[j]] = [cells[j],cells[i]];
      }

      const count = Math.min(w < 700 ? 6 : 10, cells.length);
      for(let i=0;i<count;i++){
        const cell = cells[i];
        const div = document.createElement("div");
        div.className = "sticker";

        const img = document.createElement("img");
        img.src = stickerFiles[i % stickerFiles.length];

        const cellW = w / cols;
        const cellH = h / rows;

        const size = rand(120, 240);
        div.style.width = `${size}px`;
        div.style.height = `${size}px`;

        const pad = 18;
        const x0 = cell.c * cellW + pad;
        const y0 = cell.r * cellH + pad;

        const x = x0 + rand(0, Math.max(0, cellW - size - pad*2));
        const y = y0 + rand(0, Math.max(0, cellH - size - pad*2));

        div.style.left = `${x}px`;
        div.style.top = `${y}px`;
        div.style.transform = `rotate(${rand(-18,18)}deg)`;

        div.style.pointerEvents = "auto";
        div.addEventListener("click", (e)=>{
          e.stopPropagation();
          window.open(img.src, "_blank", "noopener");
        });

        div.appendChild(img);
        wall.appendChild(div);
      }
    }
    spawnStickers();
    window.addEventListener("resize", spawnStickers);

    // ---------- ascii zoo
    const animals = [
` /\\_/\\
( o.o )
 > ^ <`,
` (\\_/)
 ( ‚Ä¢_‚Ä¢)
 / >üç™`,
`  /\\_/\\
 (=^.^=)
 (")(")`,
`  /\\_/\\
 ( >.< )
  >üçì<`,
`   /\\_/\\
  ( ‚Ä¢œâ‚Ä¢ )
  /    \\`,
`  (‚Ä¢_‚Ä¢)
 <)   )‚ïØ  i am a bug
  /   \\`,
`  [=.=]
  /|_|\\   tiny boxcat
   / \\`,
`  ‚îè(Ôºæ0Ôºæ)‚îõ
  rave gremlin`,
`  (‡∏á'ÃÄ-'ÃÅ)‡∏á
  fight me, code`,
`  Àö ö‚ô°…ûÀö
  softcore daemon`
    ];

    const creature = $("creature");
    let idx = Math.floor(Math.random()*animals.length);
    function setCreature(i){
      idx = (i + animals.length) % animals.length;
      creature.textContent = animals[idx];
    }
    setCreature(idx);

    $("reroll").addEventListener("click", ()=> setCreature(Math.floor(Math.random()*animals.length)));
    setInterval(()=> setCreature(idx+1), 6500);

    // color toggle
    $("toggleColor").addEventListener("click", ()=>{
      document.body.classList.toggle("whiteMode");
      document.querySelector(".chip strong").textContent = document.body.classList.contains("whiteMode") ? "white mode" : "pink mode";
    });

    // ---------- IndexedDB stash (images + audio)
    const DB_NAME = "bella_stash_db";
    const DB_VER = 1;
    const STORE = "files";

    function openDB(){
      return new Promise((resolve, reject)=>{
        const req = indexedDB.open(DB_NAME, DB_VER);
        req.onupgradeneeded = () => {
          const db = req.result;
          if (!db.objectStoreNames.contains(STORE)){
            const os = db.createObjectStore(STORE, { keyPath: "id" });
            os.createIndex("created", "created");
          }
        };
        req.onsuccess = ()=> resolve(req.result);
        req.onerror = ()=> reject(req.error);
      });
    }

    async function putFile(record){
      const db = await openDB();
      return new Promise((resolve, reject)=>{
        const tx = db.transaction(STORE, "readwrite");
        tx.objectStore(STORE).put(record);
        tx.oncomplete = ()=> resolve(true);
        tx.onerror = ()=> reject(tx.error);
      });
    }

    async function getAllFiles(){
      const db = await openDB();
      return new Promise((resolve, reject)=>{
        const tx = db.transaction(STORE, "readonly");
        const req = tx.objectStore(STORE).getAll();
        req.onsuccess = ()=> resolve(req.result || []);
        req.onerror = ()=> reject(req.error);
      });
    }

    async function deleteFile(id){
      const db = await openDB();
      return new Promise((resolve, reject)=>{
        const tx = db.transaction(STORE, "readwrite");
        tx.objectStore(STORE).delete(id);
        tx.oncomplete = ()=> resolve(true);
        tx.onerror = ()=> reject(tx.error);
      });
    }

    async function clearAll(){
      const db = await openDB();
      return new Promise((resolve, reject)=>{
        const tx = db.transaction(STORE, "readwrite");
        tx.objectStore(STORE).clear();
        tx.oncomplete = ()=> resolve(true);
        tx.onerror = ()=> reject(tx.error);
      });
    }

    function humanSize(bytes){
      if (!Number.isFinite(bytes)) return "unknown";
      const units = ["B","KB","MB","GB"];
      let i = 0;
      let b = bytes;
      while(b >= 1024 && i < units.length-1){ b/=1024; i++; }
      return `${b.toFixed(i===0?0:1)} ${units[i]}`;
    }

    function renderStash(list){
      $("stashCount").textContent = String(list.length);
      const stash = $("stash");
      stash.innerHTML = "";

      if (!list.length){
        stash.innerHTML = `<div class="small" style="color:var(--muted);">no files yet. add something cursed. (:3)</div>`;
        $("player").style.display = "none";
        return;
      }

      // newest first
      list.sort((a,b)=> (b.created||0) - (a.created||0));

      for (const item of list){
        const row = document.createElement("div");
        row.className = "stashItem";

        const thumb = document.createElement("div");
        thumb.className = "thumb";

        if (item.type.startsWith("image/")){
          const img = document.createElement("img");
          img.src = item.dataURL;
          img.alt = "";
          thumb.innerHTML = "";
          thumb.appendChild(img);
        } else if (item.type.startsWith("audio/")){
          thumb.textContent = "audio";
        } else {
          thumb.textContent = "file";
        }

        const meta = document.createElement("div");
        meta.className = "meta";
        meta.innerHTML = `
          <div class="name">${escapeHtml(item.name)}</div>
          <div class="info">type: ${escapeHtml(item.type)} ‚Ä¢ size: ${humanSize(item.size)} ‚Ä¢ saved: ${new Date(item.created).toLocaleString()}</div>
        `;

        const actions = document.createElement("div");
        actions.className = "stashActions";

        const btnOpen = document.createElement("button");
        btnOpen.className = "btn";
        btnOpen.type = "button";
        btnOpen.innerHTML = `<span class="k">open</span> view`;

        btnOpen.addEventListener("click", ()=>{
          if (item.type.startsWith("image/")){
            window.open(item.dataURL, "_blank", "noopener");
          } else if (item.type.startsWith("audio/")){
            const player = $("player");
            player.src = item.dataURL;
            player.style.display = "block";
            player.play().catch(()=>{});
          } else {
            window.open(item.dataURL, "_blank", "noopener");
          }
        });

        const btnDel = document.createElement("button");
        btnDel.className = "btn";
        btnDel.type = "button";
        btnDel.innerHTML = `<span class="k">rm</span> delete`;

        btnDel.addEventListener("click", async ()=>{
          await deleteFile(item.id);
          loadAndRender();
        });

        actions.appendChild(btnOpen);
        actions.appendChild(btnDel);
        meta.appendChild(actions);

        row.appendChild(thumb);
        row.appendChild(meta);
        stash.appendChild(row);
      }
    }

    function escapeHtml(s){
      return String(s).replace(/[&<>"']/g, (m) => ({
        "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"
      }[m]));
    }

    async function loadAndRender(){
      try{
        const all = await getAllFiles();
        renderStash(all);
      }catch(e){
        $("stash").innerHTML = `<div class="small" style="color:var(--muted);">stash error: ${escapeHtml(String(e))}</div>`;
      }
    }

    $("fileInput").addEventListener("change", async (e)=>{
      const file = e.target.files && e.target.files[0];
      if (!file) return;

      // keep it reasonable (you can raise this)
      const MAX_MB = 25;
      if (file.size > MAX_MB * 1024 * 1024){
        alert(`too big (${humanSize(file.size)}). keep it under ${MAX_MB} MB for local stash.`);
        e.target.value = "";
        return;
      }

      const reader = new FileReader();
      reader.onload = async () => {
        const id = crypto.randomUUID ? crypto.randomUUID() : String(Date.now()) + "_" + Math.random().toString(16).slice(2);
        const record = {
          id,
          name: file.name,
          type: file.type || "application/octet-stream",
          size: file.size,
          created: Date.now(),
          dataURL: reader.result
        };
        await putFile(record);
        e.target.value = "";
        loadAndRender();
      };
      reader.readAsDataURL(file);
    });

    $("clearStash").addEventListener("click", async ()=>{
      if (!confirm("wipe the whole local stash?")) return;
      await clearAll();
      loadAndRender();
    });

    loadAndRender();
  </script>
</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>glitch • bella cactus</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="icon" type="image/png" href="../media/favicon.png" />

  <style>
    :root{
      --bg:#070707;
      --bg2:#0b0b0b;
      --panel: rgba(255,255,255,0.055);
      --panel2: rgba(255,255,255,0.03);
      --border: rgba(255,255,255,0.10);
      --text:#f7f7f7;
      --muted:#b9b9c2;
      --pink:#ff78c8;
      --pink2:#ffb3e6;
      --shadow: 0 20px 70px rgba(0,0,0,0.55);
      --radius:16px;
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      --sans: ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, Arial, sans-serif;
    }

    *{box-sizing:border-box;}
    html,body{height:100%;}
    body{
      margin:0;
      background:
        radial-gradient(900px 600px at 15% 12%, rgba(255,120,200,0.14), transparent 55%),
        radial-gradient(900px 600px at 90% 30%, rgba(255,179,230,0.10), transparent 55%),
        radial-gradient(1200px 700px at 40% 95%, rgba(255,77,184,0.08), transparent 55%),
        linear-gradient(180deg, var(--bg), var(--bg2));
      color:var(--text);
      font-family: var(--sans);
      overflow-x:hidden;
    }

    a{color:var(--pink); text-decoration:none;}
    a:hover{text-decoration:underline;}

    .pulseText{
      background: linear-gradient(90deg, #ffffff, var(--pink), #ffffff, var(--pink2), #ffffff);
      background-size: 260% 100%;
      -webkit-background-clip:text;
      background-clip:text;
      color:transparent;
      animation: shimmer 4.8s ease-in-out infinite;
    }
    @keyframes shimmer{
      0%{background-position:0% 50%;}
      50%{background-position:100% 50%;}
      100%{background-position:0% 50%;}
    }

    .wrap{
      max-width:1050px;
      margin:0 auto;
      padding:42px 16px 110px;
      position:relative;
      z-index:2;
    }

    .top{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:14px;
      margin-bottom:14px;
    }
    .brand{
      display:flex;
      align-items:center;
      gap:14px;
      min-width:0;
    }
    .badge{
      width:56px;height:56px;border-radius:14px;
      background: linear-gradient(180deg, rgba(255,120,200,0.22), rgba(255,120,200,0.06));
      border:1px solid rgba(255,120,200,0.25);
      display:grid;place-items:center;
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    .badge img{ width:100%; height:100%; object-fit:cover; }
    h1{
      margin:0;
      font-size:2rem;
      letter-spacing:0.4px;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }
    .sub{ margin:4px 0 0; color:var(--muted); font-size:0.98rem; }

    .chips{ display:flex; gap:8px; flex-wrap:wrap; justify-content:flex-end; }
    .chip{
      font-size:0.82rem;
      padding:6px 10px;
      border-radius:999px;
      border:1px solid var(--border);
      background: rgba(255,255,255,0.04);
      color:var(--muted);
      backdrop-filter: blur(6px);
      font-family: var(--mono);
    }
    .chip .dot{
      display:inline-block;width:6px;height:6px;border-radius:999px;margin-right:6px;
      background:var(--pink);
      box-shadow:0 0 12px rgba(255,120,200,0.6);
    }

    .panel{
      background: linear-gradient(180deg, var(--panel), var(--panel2));
      border:1px solid var(--border);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow:hidden;
      position:relative;
    }
    .panelTitle{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      padding:14px 16px;
      border-bottom:1px solid rgba(255,255,255,0.06);
      background: rgba(0,0,0,0.18);
    }
    .panelTitle h2{ margin:0; font-size:1.05rem; color:var(--pink2); letter-spacing:0.3px; }
    .small{ font-size:0.86rem; color:var(--muted); }
    .panelInner{ padding:16px; }

    .btnRow{ display:flex; gap:10px; flex-wrap:wrap; margin-top:10px; }
    .btn{
      cursor:pointer;
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding:10px 12px;
      border-radius:12px;
      border:1px solid rgba(255,255,255,0.10);
      background: rgba(255,255,255,0.05);
      color:var(--text);
      transition: transform 0.08s ease, background 0.2s ease, border 0.2s ease, opacity 0.2s ease;
      text-decoration:none;
      user-select:none;
    }
    .btn:hover{
      text-decoration:none;
      transform: translateY(-1px);
      border-color: rgba(255,120,200,0.35);
      background: rgba(255,120,200,0.10);
    }
    .btn:active{ transform: translateY(0); opacity:0.95; }
    .btn .k{ font-family: var(--mono); font-size:0.8rem; color:var(--pink2); }

    .grid{
      display:grid;
      grid-template-columns: 1.25fr 0.75fr;
      gap:14px;
      margin-top:14px;
    }
    @media (max-width: 880px){ .grid{ grid-template-columns: 1fr; } .chips{justify-content:flex-start;} }

    .stage{
      position:relative;
      border-radius: 16px;
      overflow:hidden;
      border:1px solid rgba(255,255,255,0.10);
      background: rgba(0,0,0,0.35);
      height: min(66vh, 560px);
      box-shadow: inset 0 0 0 1px rgba(255,255,255,0.06);
    }
    canvas#cv{
      width:100%;
      height:100%;
      display:block;
    }

    /* scanlines + flicker overlay */
    .overlay{
      pointer-events:none;
      position:absolute;
      inset:0;
      mix-blend-mode: screen;
      opacity:0.28;
      background:
        repeating-linear-gradient(
          to bottom,
          rgba(255,255,255,0.05) 0px,
          rgba(255,255,255,0.05) 1px,
          rgba(0,0,0,0) 3px,
          rgba(0,0,0,0) 6px
        );
      animation: drift 6s linear infinite;
    }
    @keyframes drift{
      0%{ transform: translateY(0); }
      100%{ transform: translateY(18px); }
    }

    .flick{
      pointer-events:none;
      position:absolute;
      inset:-20%;
      background: radial-gradient(600px 280px at 30% 30%, rgba(255,120,200,0.14), transparent 55%),
                  radial-gradient(500px 260px at 85% 65%, rgba(255,179,230,0.10), transparent 55%);
      opacity:0.22;
      animation: flicker 2.4s steps(1) infinite;
    }
    @keyframes flicker{
      0%, 18%, 22%, 45%, 62%, 100% { opacity:0.22; filter:none; }
      19%, 21% { opacity:0.38; filter: saturate(1.2) contrast(1.2); }
      46% { opacity:0.12; }
      63% { opacity:0.33; filter: hue-rotate(6deg); }
    }

    .codebox{
      font-family: var(--mono);
      font-size: 12px;
      line-height: 1.35;
      background: rgba(0,0,0,0.35);
      border: 1px solid rgba(255,255,255,0.08);
      border-radius: 14px;
      padding: 12px;
      color: rgba(255,255,255,0.92);
      overflow:auto;
    }
    .codebox .pink{ color:var(--pink2); text-shadow:0 0 10px rgba(255,120,200,0.25); }

    input[type="range"]{ accent-color: var(--pink); width: 100%; }

    .field{
      display:flex;
      flex-direction:column;
      gap:6px;
      margin-top:10px;
    }

    .oneko{
      position:fixed;
      bottom:12px;
      right:12px;
      z-index:5;
      opacity:0.95;
      filter: drop-shadow(0 14px 28px rgba(0,0,0,0.6));
      animation: floaty 3.6s ease-in-out infinite;
      cursor:pointer;
      user-select:none;
    }
    @keyframes floaty{
      0%{transform: translateY(0);}
      50%{transform: translateY(-6px);}
      100%{transform: translateY(0);}
    }
    .oneko img{ width:52px; image-rendering:pixelated; display:block; }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="top">
      <div class="brand">
        <div class="badge" aria-hidden="true">
          <img src="../media/twi looking.png" alt="badge" />
        </div>
        <div class="titlebox">
          <h1 class="pulseText">glitch gallery</h1>
          <div class="sub">distort pixels • flicker reality • reroll corruption (:3)</div>
        </div>
      </div>

      <div class="chips">
        <div class="chip"><span class="dot"></span> <span class="pulseText">black/white/pink</span></div>
        <div class="chip" id="stat">status: booting</div>
      </div>
    </div>

    <div class="grid">
      <section class="panel">
        <div class="panelTitle">
          <h2>stage</h2>
          <div class="small">drag an image in, or use the default</div>
        </div>
        <div class="panelInner">
          <div class="btnRow">
            <a class="btn" href="../index.html"><span class="k">cd</span> home</a>
            <button class="btn" id="btnReroll" type="button"><span class="k">rng</span> reroll corruption</button>
            <button class="btn" id="btnFreeze" type="button"><span class="k">⏸</span> freeze</button>
            <label class="btn" style="cursor:pointer;">
              <span class="k">up</span> load image
              <input id="file" type="file" accept="image/*" style="display:none;">
            </label>
          </div>

          <div class="stage" id="stage">
            <canvas id="cv"></canvas>
            <div class="overlay"></div>
            <div class="flick"></div>
          </div>

          <div class="small" style="margin-top:10px;">
            tip: you can also <span class="pulseText">drag & drop</span> an image onto the stage. it’s local-only, not uploaded anywhere.
          </div>
        </div>
      </section>

      <aside class="panel">
        <div class="panelTitle">
          <h2>controls</h2>
          <div class="small pulseText">spicy sliders</div>
        </div>
        <div class="panelInner">
          <div class="field">
            <div class="small">glitch intensity: <span id="vInt">0.55</span></div>
            <input id="rngInt" type="range" min="0" max="1" step="0.01" value="0.55">
          </div>

          <div class="field">
            <div class="small">scanline strength: <span id="vScan">0.28</span></div>
            <input id="rngScan" type="range" min="0" max="0.7" step="0.01" value="0.28">
          </div>

          <div class="field">
            <div class="small">flicker: <span id="vFlick">0.22</span></div>
            <input id="rngFlick" type="range" min="0" max="0.6" step="0.01" value="0.22">
          </div>

          <div class="field">
            <div class="small">message payload</div>
            <div class="codebox" id="payload">
              <span class="pink">[corruption]</span> seed: <span id="seedOut">000000</span><br>
              <span class="pink">[mode]</span> drift + slice + chroma<br>
              <span class="pink">[note]</span> this is fake hacking. real hacking is boring paperwork.
            </div>
          </div>

          <div class="field">
            <div class="small">ascii tag</div>
            <div class="codebox" id="tag">
<pre>   /\_/\   <span class="pink">glitch cat</span>
  ( o.o )  slicing pixels
   > ^ <   please do not pet the gpu</pre>
            </div>
          </div>
        </div>
      </aside>
    </div>
  </div>

  <div class="oneko" id="oneko" title="click me">
    <img id="onekoImg" src="../media/oneko.gif" alt="oneko" />
  </div>

  <audio id="yeah" preload="auto">
    <source src="../assests/lil-jon-yeah.mp3" type="audio/mpeg" />
  </audio>

  <script>
    const $ = (id) => document.getElementById(id);
    const rand = (a,b) => a + Math.random()*(b-a);
    const clamp = (n,a,b) => Math.max(a, Math.min(b,n));

    // oneko fallback + click
    const onekoImg = $("onekoImg");
    onekoImg.addEventListener("error", () => {
      if (!onekoImg.dataset.tried) { onekoImg.dataset.tried="1"; onekoImg.src="../media/oneko.gif"; }
    });
    $("oneko").addEventListener("click", () => {
      const y = $("yeah");
      y.currentTime = 0;
      y.play().catch(()=>{});
    });

    // canvas setup
    const cv = $("cv");
    const ctx = cv.getContext("2d", { willReadFrequently:true });

    function fit(){
      const dpr = devicePixelRatio || 1;
      const stage = $("stage").getBoundingClientRect();
      cv.width = Math.floor(stage.width * dpr);
      cv.height = Math.floor(stage.height * dpr);
      cv.style.width = stage.width + "px";
      cv.style.height = stage.height + "px";
      ctx.setTransform(dpr,0,0,dpr,0,0);
    }
    addEventListener("resize", fit);

    // default image: try your existing stickers, fallback to procedural
    const defaults = ["../media/twi and trixy.jpg", "../media/ponies in bed.jpg", "../media/yuri meme.png", "../media/twi looking.png"];
    let baseImg = new Image();
    baseImg.crossOrigin = "anonymous";

    function loadDefault(){
      const src = defaults[Math.floor(Math.random() * defaults.length)];
      baseImg = new Image();
      baseImg.onload = () => { $("stat").textContent = "status: loaded"; };
      baseImg.onerror = () => { baseImg = null; $("stat").textContent = "status: procedural"; };
      baseImg.src = src;
    }
    loadDefault();

    // seed / params
    let seed = Math.floor(Math.random()*1e9);
    let frozen = false;

    function reroll(){
      seed = Math.floor(Math.random()*1e9);
      $("seedOut").textContent = String(seed).padStart(6,"0").slice(-6);
      $("stat").textContent = "status: corrupted";
      // small chance to pick new default
      if (Math.random() < 0.35) loadDefault();
    }

    // controls
    const rngInt = $("rngInt");
    const rngScan = $("rngScan");
    const rngFlick = $("rngFlick");

    function syncUI(){
      $("vInt").textContent = Number(rngInt.value).toFixed(2);
      $("vScan").textContent = Number(rngScan.value).toFixed(2);
      $("vFlick").textContent = Number(rngFlick.value).toFixed(2);
      document.querySelector(".overlay").style.opacity = rngScan.value;
      document.querySelector(".flick").style.opacity = rngFlick.value;
    }
    rngInt.addEventListener("input", syncUI);
    rngScan.addEventListener("input", syncUI);
    rngFlick.addEventListener("input", syncUI);
    syncUI();

    $("btnReroll").addEventListener("click", reroll);
    $("btnFreeze").addEventListener("click", () => {
      frozen = !frozen;
      $("btnFreeze").innerHTML = frozen ? `<span class="k">▶</span> unfreeze` : `<span class="k">⏸</span> freeze`;
    });

    // file load
    $("file").addEventListener("change", (e) => {
      const f = e.target.files && e.target.files[0];
      if (!f) return;
      const url = URL.createObjectURL(f);
      const img = new Image();
      img.onload = () => { baseImg = img; reroll(); URL.revokeObjectURL(url); };
      img.src = url;
    });

    // drag drop
    const stageEl = $("stage");
    stageEl.addEventListener("dragover", (e) => { e.preventDefault(); });
    stageEl.addEventListener("drop", (e) => {
      e.preventDefault();
      const f = e.dataTransfer && e.dataTransfer.files && e.dataTransfer.files[0];
      if (!f || !f.type.startsWith("image/")) return;
      const url = URL.createObjectURL(f);
      const img = new Image();
      img.onload = () => { baseImg = img; reroll(); URL.revokeObjectURL(url); };
      img.src = url;
    });

    // tiny seeded RNG
    function sRand(){
      // xorshift32
      seed ^= seed << 13; seed >>>= 0;
      seed ^= seed >> 17; seed >>>= 0;
      seed ^= seed << 5;  seed >>>= 0;
      return (seed >>> 0) / 4294967296;
    }

    // draw base image (cover)
    function drawBase(){
      const w = stageEl.clientWidth;
      const h = stageEl.clientHeight;

      ctx.clearRect(0,0,w,h);

      // background gradient
      const g = ctx.createLinearGradient(0,0,w,h);
      g.addColorStop(0, "rgba(255,120,200,0.10)");
      g.addColorStop(1, "rgba(0,0,0,0.25)");
      ctx.fillStyle = g;
      ctx.fillRect(0,0,w,h);

      if (!baseImg){
        // procedural fallback: noisy blocks
        for (let i=0;i<120;i++){
          const x = sRand()*w, y = sRand()*h;
          const bw = 10 + sRand()*120, bh = 6 + sRand()*60;
          const a = 0.04 + sRand()*0.10;
          ctx.fillStyle = `rgba(255,120,200,${a})`;
          ctx.fillRect(x,y,bw,bh);
        }
        // label
        ctx.fillStyle = "rgba(255,255,255,0.85)";
        ctx.font = `14px ${getComputedStyle(document.documentElement).getPropertyValue("--mono") || "ui-monospace, monospace"}`;
        ctx.fillText("no image loaded • procedural corruption", 16, 28);
        return;
      }

      const iw = baseImg.naturalWidth || baseImg.width;
      const ih = baseImg.naturalHeight || baseImg.height;
      const s = Math.max(w/iw, h/ih);
      const dw = iw*s, dh = ih*s;
      const dx = (w - dw)/2, dy = (h - dh)/2;
      ctx.drawImage(baseImg, dx, dy, dw, dh);
    }

    function glitchPass(){
      const w = stageEl.clientWidth;
      const h = stageEl.clientHeight;
      const intensity = Number(rngInt.value);

      // slice + shift
      const slices = Math.floor(10 + intensity * 40);
      for (let i=0;i<slices;i++){
        const y = Math.floor(sRand() * h);
        const sh = Math.floor(2 + sRand() * (10 + intensity * 30));
        const dx = Math.floor((sRand() - 0.5) * (40 + intensity * 180));
        ctx.drawImage(cv, 0, y, w, sh, dx, y, w, sh);
      }

      // chroma offset (fake)
      const img = ctx.getImageData(0,0,w,h);
      const d = img.data;
      const shift = Math.floor(1 + intensity * 6);
      for (let y=0;y<h;y++){
        const row = y*w*4;
        const wob = Math.floor(Math.sin((y*0.02) + sRand()*6) * (intensity*10));
        for (let x=0;x<w;x++){
          const i0 = row + x*4;
          const ir = row + clamp(x + shift + wob, 0, w-1)*4;
          const ib = row + clamp(x - shift - wob, 0, w-1)*4;
          // r from ir, b from ib
          d[i0] = d[ir];
          d[i0+2] = d[ib+2];
          // tiny noise
          if (sRand() < intensity*0.02){
            d[i0] = 255;
            d[i0+1] = 120;
            d[i0+2] = 200;
          }
        }
      }
      ctx.putImageData(img,0,0);

      // text stamp
      ctx.save();
      ctx.globalAlpha = 0.18 + intensity * 0.10;
      ctx.fillStyle = "rgba(0,0,0,0.35)";
      ctx.fillRect(0, h-64, w, 64);
      ctx.globalAlpha = 0.9;
      ctx.font = `12px ${getComputedStyle(document.documentElement).getPropertyValue("--mono") || "ui-monospace, monospace"}`;
      ctx.fillStyle = "rgba(255,179,230,0.95)";
      const msg = `[corruption:${String(seed).slice(-6)}] jitter=${intensity.toFixed(2)} slices=${slices}`;
      ctx.fillText(msg, 14, h-38);
      ctx.restore();
    }

    function loop(){
      requestAnimationFrame(loop);
      if (frozen) return;

      fit();
      // make seed drift slowly so it animates
      seed = (seed + 11) >>> 0;

      drawBase();
      glitchPass();
    }

    // keyboard
    addEventListener("keydown", (e) => {
      const k = (e.key || "").toLowerCase();
      if (k === "r") reroll();
      if (k === " ") { e.preventDefault(); $("btnFreeze").click(); }
      if (k === "escape") location.href = "../index.html";
    });

    // start
    $("seedOut").textContent = String(seed).padStart(6,"0").slice(-6);
    fit();
    loop();
  </script>
</body>
</html>
